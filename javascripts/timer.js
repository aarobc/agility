var pages=pages||{};pages.timer=pages.timer||function(){function n(){$.get("./javascripts/templates/mobster.mustache").success(function(n){z=n}).then(t)}function t(){x=$(".counter"),y=x.find(".counter-text"),M=$("input.period"),B=$(".nav-timer"),R=$(".nav-timer-stop"),U=$(".nav-timer-play"),Y=$(".nav-timer-pause"),j=$(".nav-timer-settings"),q=$(".add-mobster"),F=$(".mobster-container"),C=$("title"),saveLink=$(".save-settings"),shuffleMobstersLink=$(".shuffle-mobsters"),L=$(".turn-text"),H=[],J=0,saveLink.bind("click",e),shuffleMobstersLink.bind("click",a),x.bind("click",function(){W===Q.STOPPED?m():W===Q.PAUSED?v():W===Q.PLAYING&&b()}),R.bind("click",S),U.bind("click",function(){W===Q.STOPPED?m():v()}),Y.bind("click",b),j.bind("click",b),q.bind("click",r),window.Notification&&Notification.requestPermission(),S(),o()}function e(){searchString="?";for(i in H)mobsterName=$(H[i].name).val(),"?"!=searchString&&(searchString+="&"),searchString+="mobster="+encodeURIComponent(mobsterName);searchString+="&duration="+M.val(),window.location.replace(searchString)}function o(){var n=window.location.search;if(n){var t=n.replace("?","").split("&");for(i in t){var e=t[i].split("=");if("duration"===e[0]&&$("#period").val(e[1]),"mobster"===e[0]){r();var o=$(".mobster-container").first(),a=o.find(".mobster-control-name")[i];$(a).val(decodeURIComponent(e[1]))}}}}function r(){var n=H.length,t=$(Mustache.render(z,{id:n})),e={root:t,name:t.find(".mobster-control-name")[0],disabled:!1};t.find(".mobster-control-turn").bind("click",function(){e.disabled||(J=e.root.index(),h())}),t.find(".mobster-control-up").bind("click",function(){var n=e.root.index();if(0!==n){var t=H[n-1];e.root.after(t.root),H[n]=H[n-1],H[n-1]=e}}),t.find(".mobster-control-down").bind("click",function(){var n=e.root.index();if(n!==H.length){var t=H[n+1];e.root.before(t.root),H[n]=H[n+1],H[n+1]=e}}),t.find(".mobster-control-disable").bind("click",function(){e.disabled||e===H[J]?(e.disabled=!1,e.root.removeClass("disabled")):(e.disabled=!0,e.root.addClass("disabled"))}),H.push(e),F.append(e.root)}function a(){for(var n=H.length-1;n>0;n--){var t=Math.floor(Math.random()*(n+1)),i=H[n];H[n]=H[t],H[t]=i}e()}function c(){return 60*parseInt(M[0].value,10)}function s(){K=c()}function l(){return getComputedStyle(x[0])["background-color"]}function u(){if("granted"===Notification.permission){var n="Click here and step away from the keyboard.";g()&&(n+="\n"+H[J].name.value+" is next"),G=new Notification("It's time to rotate!",{body:n,icon:"./images/rotate.png",vibrate:[200,100,200]}),G.onclick=function(){window.focus(),G.close()}}$("audio.alert")[0].play()}function d(n){y.text(n),f()}function f(){var n=["["+y.text()+"]"];g()&&n.push(P()+"'s Turn"),n.push("- Agility Timer"),C.text(n.join(" "))}function m(){E(Q.PLAYING),s(),d(w(K)),x.css({"background-color":V.START,transition:"none"}),h(),A()}function b(){W===Q.PLAYING&&(E(Q.PAUSED),x.css({"background-color":l()}),D())}function v(){E(Q.PLAYING),x.css({"background-color":V.END,transition:"background-color "+K+"s"}),A()}function p(){E(Q.STOPPED),D(),d("Rotate"),k(),u()}function g(){return H.filter(function(n){return!n.disabled}).length>=2}function h(){if(H.forEach(function(n){n.root.removeClass("active")}),g()){var n=H[J],t=n.name.value+"'s Turn";/s$/i.test(n.name.value)&&(t=n.name.value+"' Turn"),L.text(t),n.root.addClass("active")}else L.empty();f()}function k(){if(g()){do J++,J>=H.length&&(J=0);while(H[J].disabled);L.text(P()+" is next")}else L.empty();f()}function P(){return H[J].name.value}function S(){E(Q.STOPPED),D(),d("Start"),x.removeAttr("style")}function E(n){x.removeClass(W),W=n,x.addClass(n);var t;switch(n){case Q.PLAYING:t=U;break;case Q.PAUSED:t=Y;break;case Q.STOPPED:t=R}N(t),G&&G.close()}function N(n){B.children().each(function(){$(this).removeClass("active")}),n.addClass("active")}function T(){K===c()&&x.css({"background-color":V.END,transition:"background-color "+K+"s"}),K--,d(w(K)),0===K&&p()}function A(){O&&clearInterval(O),O=setInterval(T,1e3)}function D(){clearInterval(O),O=null}function w(n){var t=Math.floor(n/60),e=n%60;return I(t)+":"+I(e)}function I(n){return(10>n?"0":"")+n}var x,C,y,L,O,G,M,U,Y,R,j,B,q,z,F,H,J,K=0,Q={STOPPED:"stopped",PLAYING:"playing",PAUSED:"paused"},V={START:"#71B284",END:"#B22727"},W=Q.STOPPED;return{init:n}}(),pages.timer.init();